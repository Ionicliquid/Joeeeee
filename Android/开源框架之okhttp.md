# 基础知识
## TCP与UDP
TCP（传输控制协议）和UDP（用户数据报协议）是传输层的两大核心协议，它们在设计目标和应用场景上有显著差异。以下是它们的主要区别：

---

### **1. 连接方式**
- **TCP**：面向连接。  
  传输数据前需通过**三次握手**建立连接，结束后通过**四次挥手**断开连接。
- **UDP**：无连接。  
  直接发送数据，无需预先建立或断开连接。

---

### **2. 可靠性**
- **TCP**：**可靠传输**。  
  通过确认应答（ACK）、超时重传、数据校验等机制确保数据**不丢失、不重复、按序到达**。
- **UDP**：**不可靠传输**。  
  无确认、重传机制，数据可能丢失或乱序。

---

### **3. 传输效率**
- **TCP**：效率较低。  
  因连接管理、可靠性机制等额外开销，传输延迟较高。
- **UDP**：效率高。  
  无复杂控制机制，传输速度快，实时性更好。

---

### **4. 数据顺序**
- **TCP**：保证数据顺序。  
  接收方按发送顺序处理数据包。
- **UDP**：不保证顺序。  
  数据包可能乱序到达，需应用层自行处理。

---

### **5. 流量控制与拥塞控制**
- **TCP**：  
  - **流量控制**：通过滑动窗口机制，防止发送方过载接收方。  
  - **拥塞控制**：通过慢启动、拥塞避免等算法动态调整发送速率。
- **UDP**：无流量和拥塞控制，可能加剧网络拥塞。

---

### **6. 头部开销**
- **TCP**：头部较大（**20~60字节**），包含序列号、确认号、窗口大小等控制信息。  
- **UDP**：头部固定仅**8字节**，更轻量。

---

### **7. 数据边界**
- **TCP**：**流式传输**。  
  无明确数据边界，接收方可能合并多次发送的数据（如发送两次100字节数据，可能一次接收200字节）。  
- **UDP**：**数据报传输**。  
  保留发送时的数据边界（发送两次100字节数据，接收方分两次读取）。

---

### **8. 传输模式**
- **TCP**：仅支持**一对一**通信。  
- **UDP**：支持**一对一、一对多、多对多**（广播、多播）。

---

### **9. 应用场景**
- **TCP**：  
  适用于对可靠性要求高的场景，如：  
  - 网页浏览（HTTP/HTTPS）  
  - 文件传输（FTP）  
  - 电子邮件（SMTP/POP3）  
  - 数据库连接  

- **UDP**：  
  适用于实时性优先的场景，如：  
  - 实时视频/语音通话（Zoom、VoIP）  
  - 在线游戏（低延迟需求）  
  - DNS查询  
  - 物联网传感器数据传输  

---

### **总结对比表**
| 特性                | TCP                                  | UDP                                  |
|---------------------|--------------------------------------|--------------------------------------|
| **连接方式**        | 面向连接（三次握手）                | 无连接                               |
| **可靠性**          | 可靠传输（确认、重传机制）          | 不可靠传输                           |
| **传输效率**        | 较低（控制机制复杂）                | 较高（轻量级）                       |
| **数据顺序**        | 保证顺序                            | 不保证顺序                           |
| **流量/拥塞控制**   | 支持                                | 不支持                               |
| **头部大小**        | 20~60字节                           | 8字节                                |
| **数据边界**        | 流式（无边界）                      | 数据报（保留边界）                   |
| **适用场景**        | 可靠性优先（文件传输、网页）        | 实时性优先（视频、游戏、广播）       |

---

### **如何选择？**
- **需要可靠传输**（如文件下载）：选TCP。  
- **需要低延迟或实时性**（如直播、游戏）：选UDP。  
- 某些应用（如QUIC/HTTP3）会在UDP上实现可靠性机制，结合两者优势。
## HTTP与HTTPS
## 一次网络请求的发起过程

# 分发器

# 拦截器

1. 请求的执行流程：构建请求 -> 分发器 -> 拦截器 -> 获得响应；
2. 分发器：内部维护队列与线程池，用来控制请求数与请求线程；
3. 拦截器：完成请求；
   1. RetryAndFollowUpInterceptor：重试与重定向
   2. BridgeInterceptor：桥接拦截器
   3. CacheInterceptor：缓存拦截器
   4. ConnectInterceptor：连接拦截器
   5. CallServerInterceptor：请求服务器拦截器

## RetryAndFollowUpInterceptor

1. 重试用来处理特定的IO异常和路由异常
   1. 重试是可配置
   2. 部分异常如协议异常，握手异常 证书异常 不能重试
   3. 存在更多路径选择，DNS解析返回了多个IP ，挨个重试` RouteSelector#resetNextInetSocketAddress`
2. 重定向 针对特定的返回码重新请求
   1. 407 客户端使用了代理，需要添加Proxy-Authorization请求头，并配置密码；
   2. 308：永久重定向，并且请求为Get形式

##  BridgeInterceptor

1. 补全请求头，HOST/User-Agent等
2. 对于使用Gzip 返回的响应，会通过GzipSource 之后 用于下游解析

##  CacheInterceptor

## ConnectInterceptor

1. 所谓的连接就是指一个Socket， 该拦截器的主要作用 就是维护一个连接池；
2. 连接被创建成功后会加入到连接队列中，并开启一个线程轮询检查队列；
3. 最大闲置数为五个，最长闲置时间为五分钟，超过之后按时间顺序清理，不满足条件则线程等待

## CallServerInterceptor

### 参考链接


